From 50e48dfabffb63bb6dcff91a25aefb71b65226cd Mon Sep 17 00:00:00 2001
From: Suman Anna <s-anna@ti.com>
Date: Mon, 18 Feb 2019 13:41:19 -0600
Subject: [PATCH 45/51] ARM: dts: AM33xx: Add the PRU-ICSS DT nodes

commit fd83ac61330f9ca28c9a89339e490a3d998e7558 from
https://git.ti.com/cgit/processor-sdk/processor-sdk-linux/?h=processor-sdk-linux-01.00.00

Add the DT nodes for the PRU-ICSS on AM33xx family of SoCs. The
AM33xx SoCs contain a single PRU-ICSS instance and is represented
by the pruss-soc-bus node and a child PRUSS node. PRU-ICSS is not
supported on AM3352 SoC though in the AM33xx family, so the nodes
are added in disabled state to the common am33xx dtsi file. They
should be enabled in only those derivative board files that use
a SoC containing PRU-ICSS.

The PRUSS subsystem node contains the entire address space and
the various interrupts generated towards the main MPU. The various
sub-modules of the PRU-ICSS are represented as individual child
nodes (so platform devices themselves) of the PRUSS subsystem node.
These include the two PRU cores and the interrupt controller. The
Industrial Ethernet Peripheral (IEP), the Real Time Media Independent
Interface controller (MII_RT), and the CFG sub-module are represented
as syscon nodes. All the Data RAMs are represented within a child
node of its own named 'memories' without any compatible.

The DT nodes use all standard properties. The regs property in
the PRU nodes define the addresses for the Instruction RAM, the
Debug and Control sub-modules for that PRU core. The firmware for
each PRU core is defined through a 'firmware-name' property.

The default names for the firmware images for each PRU core are
defined as follows (these can be adjusted either in derivative
board dts files or through sysfs at runtime if required):
     PRU-ICSS PRU0 Core: am335x-pru1_0-fw
     PRU-ICSS PRU1 Core: am335x-pru1_1-fw

Signed-off-by: Suman Anna <s-anna@ti.com>
Signed-off-by: Xiaolei Wang <xiaolei.wang@windriver.com>
---
 arch/arm/boot/dts/am33xx.dtsi | 86 +++++++++++++++++++++++++++++++++++
 1 file changed, 86 insertions(+)

diff --git a/arch/arm/boot/dts/am33xx.dtsi b/arch/arm/boot/dts/am33xx.dtsi
index 5a2907e34126..e99bd687af34 100644
--- a/arch/arm/boot/dts/am33xx.dtsi
+++ b/arch/arm/boot/dts/am33xx.dtsi
@@ -425,6 +425,92 @@
 			};
 		};
 
+		pruss_soc_bus: pruss-soc-bus@4a326004 {
+                        compatible = "ti,am3356-pruss-soc-bus";
+                        reg = <0x4a326004 0x4>;
+                        ti,hwmods = "pruss";
+                        #address-cells = <1>;
+                        #size-cells = <1>;
+                        ranges;
+                        status = "disabled";
+
+                        pruss: pruss@4a300000 {
+                                compatible = "ti,am3356-pruss";
+                                reg = <0x4a300000 0x80000>;
+                                interrupts = <20 21 22 23 24 25 26 27>;
+                                interrupt-names = "host2", "host3", "host4",
+                                                  "host5", "host6", "host7",
+                                                  "host8", "host9";
+                                #address-cells = <1>;
+                                #size-cells = <1>;
+                                ranges;
+                                status = "disabled";
+
+                                pruss_mem: memories@4a300000 {
+                                        reg = <0x4a300000 0x2000>,
+                                              <0x4a302000 0x2000>,
+                                              <0x4a310000 0x3000>,
+                                              <0x4a32e000 0x31c>,
+                                              <0x4a330000 0x60>;
+                                        reg-names = "dram0", "dram1",
+                                                    "shrdram2", "iep", "ecap";
+                                };
+
+                                pruss_cfg: cfg@4a326000 {
+                                        compatible = "syscon";
+                                        reg = <0x4a326000 0x2000>;
+                                };
+
+                                pruss_mii_rt: mii-rt@4a332000 {
+                                        compatible = "syscon";
+                                        reg = <0x4a332000 0x58>;
+                                };
+
+				pruss_intc: interrupt-controller@4a320000 {
+                                        compatible = "ti,am3356-pruss-intc";
+                                        reg = <0x4a320000 0x2000>;
+                                        interrupt-controller;
+                                        #interrupt-cells = <1>;
+                                };
+
+                                pru0: pru@4a334000 {
+                                        compatible = "ti,am3356-pru";
+                                        reg = <0x4a334000 0x2000>,
+                                              <0x4a322000 0x400>,
+                                              <0x4a322400 0x100>;
+                                        reg-names = "iram", "control", "debug";
+                                        firmware-name = "am335x-pru0-fw";
+                                        interrupt-parent = <&pruss_intc>;
+                                        interrupts = <16>, <17>;
+                                        interrupt-names = "vring", "kick";
+                                };
+
+                                pru1: pru@4a338000 {
+                                        compatible = "ti,am3356-pru";
+                                        reg = <0x4a338000 0x2000>,
+                                              <0x4a324000 0x400>,
+                                              <0x4a324400 0x100>;
+                                        reg-names = "iram", "control", "debug";
+                                        firmware-name = "am335x-pru1-fw";
+                                        interrupt-parent = <&pruss_intc>;
+                                        interrupts = <18>, <19>;
+                                        interrupt-names = "vring", "kick";
+                                };
+
+                                pruss_mdio: mdio@4a332400 {
+                                        compatible = "ti,davinci_mdio";
+                                        reg = <0x4a332400 0x90>;
+                                        clocks = <&dpll_core_m4_ck>;
+                                        clock-names = "fck";
+                                        bus_freq = <1000000>;
+                                        #address-cells = <1>;
+                                        #size-cells = <0>;
+                                        status = "disabled";
+                                };
+                        };
+                };
+
+
 		emif: emif@4c000000 {
 			compatible = "ti,emif-am3352";
 			reg = <0x4c000000 0x1000000>;
-- 
2.17.1

