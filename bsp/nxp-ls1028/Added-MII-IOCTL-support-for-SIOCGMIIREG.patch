From e7ada31bba3c75aa2e4b0d8d753eb1bb4fdb3d75 Mon Sep 17 00:00:00 2001
From: Vicentiu Galanopulo <vicentiu.galanopulo@nxp.com>
Date: Tue, 7 Nov 2017 16:15:03 +0200
Subject: [PATCH 174/741] Added MII IOCTL support for SIOCGMIIREG

commit 0320cf67e5f950f858439e6aa2f8d99665e65474 from
http://source.codeaurora.org/external/qoriq/qoriq-components/linux

Signed-off-by: Vicentiu Galanopulo <vicentiu.galanopulo@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 .../ethernet/freescale/sdk_dpaa/dpaa_eth_common.c    | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c b/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c
index d39afc2c27e6..0c16034c984b 100644
--- a/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c
+++ b/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c
@@ -444,14 +444,18 @@ int dpa_ioctl(struct net_device *dev, struct ifreq *rq, int cmd)
 #ifdef CONFIG_FSL_DPAA_1588
 	struct dpa_priv_s *priv = netdev_priv(dev);
 #endif
-	int ret = 0;
+	int ret = -EINVAL;
 
-	/* at least one timestamping feature must be enabled */
-#ifdef CONFIG_FSL_DPAA_TS
 	if (!netif_running(dev))
-#endif
 		return -EINVAL;
 
+	if (cmd == SIOCGMIIREG) {
+		if (!dev->phydev)
+			ret = -EINVAL;
+		else
+			ret = phy_mii_ioctl(dev->phydev, rq, cmd);
+	}
+
 #ifdef CONFIG_FSL_DPAA_TS
 	if (cmd == SIOCSHWTSTAMP)
 		return dpa_ts_ioctl(dev, rq, cmd);
-- 
2.17.1

