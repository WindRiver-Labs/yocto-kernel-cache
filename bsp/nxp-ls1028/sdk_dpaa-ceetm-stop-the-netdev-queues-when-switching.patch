From 384b3edd76154f44b97e600eb06c4d7fd1f46053 Mon Sep 17 00:00:00 2001
From: Camelia Groza <camelia.groza@nxp.com>
Date: Mon, 19 Mar 2018 18:39:59 +0200
Subject: [PATCH 203/741] sdk_dpaa: ceetm: stop the netdev queues when
 switching ceetm on

commit 67d32ec4e2f0e3d612a79525fe04cfd0361e42d7 from
http://source.codeaurora.org/external/qoriq/qoriq-components/linux

Signed-off-by: Camelia Groza <camelia.groza@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_ceetm.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_ceetm.c b/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_ceetm.c
index ed6c2e0b9bcd..e23113c88917 100644
--- a/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_ceetm.c
+++ b/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_ceetm.c
@@ -1100,7 +1100,9 @@ static int ceetm_init(struct Qdisc *sch, struct nlattr *opt,
 
 	switch (priv->type) {
 	case CEETM_ROOT:
+		netif_tx_stop_all_queues(dev);
 		ret = ceetm_init_root(sch, priv, qopt, extack);
+		netif_tx_wake_all_queues(dev);
 		break;
 	case CEETM_PRIO:
 		ret = ceetm_init_prio(sch, priv, qopt);
-- 
2.17.1

