From 0ef149ac28f0f387635fc3ea05e6e214ff4a54bd Mon Sep 17 00:00:00 2001
From: Hou Zhiqiang <Zhiqiang.Hou@nxp.com>
Date: Thu, 1 Nov 2018 16:00:47 +0800
Subject: [PATCH 299/741] PCI: mobiveil: correct PCI base address in MEM/IO
 outbound windows

commit ca79517fb11f50ea4522434f7497d1463241adfe from
http://source.codeaurora.org/external/qoriq/qoriq-components/linux

It should get PCI base address from the DT node property 'ranges'
to setup MEM/IO outbound windows instead of always zero.

Fixes: 9af6bcb11e12 ("PCI: mobiveil: Add Mobiveil PCIe Host Bridge
IP driver")
Signed-off-by: Hou Zhiqiang <Zhiqiang.Hou@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/pci/controller/pcie-mobiveil.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/pci/controller/pcie-mobiveil.c b/drivers/pci/controller/pcie-mobiveil.c
index c98b4c15e268..0f2a2655c116 100644
--- a/drivers/pci/controller/pcie-mobiveil.c
+++ b/drivers/pci/controller/pcie-mobiveil.c
@@ -636,8 +636,9 @@ static int mobiveil_host_init(struct mobiveil_pcie *pcie)
 
                 /* configure outbound translation window */
                 program_ob_windows(pcie, pcie->ob_wins_configured,
-                                   win->res->start, 0, type,
-                                   resource_size(win->res));
+				   win->res->start,
+                                   win->res->start - win->offset,
+                                   type, resource_size(win->res));
 	}
 
 	/* fixup for PCIe class register */
-- 
2.17.1

