From eeff329c7e437592ffbc720e3d5ead836f01f93f Mon Sep 17 00:00:00 2001
From: costi <constantin.tudor@freescale.com>
Date: Tue, 7 Mar 2017 16:13:07 +0200
Subject: [PATCH 111/741] staging: fsl-dpaa2/mac: Remove link type from phy sel
 logic

commit 77dfef3f2f180c32f0283ffbaccd4d7dafd51485 from
http://source.codeaurora.org/external/qoriq/qoriq-components/linux

Signed-off-by: Constantin Tudor <constantin.tudor@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/staging/fsl-dpaa2/mac/mac.c | 13 ++++---------
 1 file changed, 4 insertions(+), 9 deletions(-)

diff --git a/drivers/staging/fsl-dpaa2/mac/mac.c b/drivers/staging/fsl-dpaa2/mac/mac.c
index 2973cf1c7c57..427acaa09306 100644
--- a/drivers/staging/fsl-dpaa2/mac/mac.c
+++ b/drivers/staging/fsl-dpaa2/mac/mac.c
@@ -545,8 +545,11 @@ static int dpaa2_mac_probe(struct fsl_mc_device *mc_dev)
 	/* probe the PHY as a fixed-link if the link type declared in DPC
 	 * explicitly mandates this
 	 */
-	if (priv->attr.link_type == DPMAC_LINK_TYPE_FIXED)
+
+	phy_node = of_parse_phandle(dpmac_node, "phy-handle", 0);
+	if (!phy_node) {
 		goto probe_fixed_link;
+	}
 
 	if (priv->attr.eth_if < ARRAY_SIZE(dpaa2_mac_iface_mode)) {
 		if_mode = dpaa2_mac_iface_mode[priv->attr.eth_if];
@@ -559,14 +562,6 @@ static int dpaa2_mac_probe(struct fsl_mc_device *mc_dev)
 	}
 
 	/* try to connect to the PHY */
-	phy_node = of_parse_phandle(dpmac_node, "phy-handle", 0);
-	if (!phy_node) {
-		if (!phy_node) {
-			dev_err(dev, "dpmac node has no phy-handle property\n");
-			err = -ENODEV;
-			goto err_no_phy;
-		}
-	}
 	netdev->phydev = of_phy_connect(netdev, phy_node,
 					&dpaa2_mac_link_changed, 0, if_mode);
 	if (!netdev->phydev) {
-- 
2.17.1

