From a25fbd451235b0450b943718871c870a1e08e265 Mon Sep 17 00:00:00 2001
From: Laurentiu Tudor <laurentiu.tudor@nxp.com>
Date: Thu, 17 May 2018 11:56:27 +0300
Subject: [PATCH 018/741] arm64: dts: ls104x: add iommu-map to pci controllers

commit fc37b37d322ca0e680ce0e6872871613a02f5e41 from
http://source.codeaurora.org/external/qoriq/qoriq-components/linux

The pci controllers are also behind the smmu so add the iommu-map
property to reflect this. The bootloader needs to patch the stream id
ranges to some sane values.

Signed-off-by: Laurentiu Tudor <laurentiu.tudor@nxp.com>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi | 3 +++
 arch/arm64/boot/dts/freescale/fsl-ls1046a.dtsi | 3 +++
 2 files changed, 6 insertions(+)

diff --git a/arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi b/arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi
index 960f27c93f3f..523bfe0297db 100644
--- a/arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi
@@ -828,6 +828,7 @@
 			#size-cells = <2>;
 			device_type = "pci";
 			dma-coherent;
+			iommu-map = <0 &smmu 0 1>;
 			num-lanes = <4>;
 			num-viewport = <6>;
 			bus-range = <0x0 0xff>;
@@ -855,6 +856,7 @@
 			#size-cells = <2>;
 			device_type = "pci";
 			dma-coherent;
+			iommu-map = <0 &smmu 0 1>;
 			num-lanes = <2>;
 			num-viewport = <6>;
 			bus-range = <0x0 0xff>;
@@ -882,6 +884,7 @@
 			#size-cells = <2>;
 			device_type = "pci";
 			dma-coherent;
+			iommu-map = <0 &smmu 0 1>;
 			num-lanes = <2>;
 			num-viewport = <6>;
 			bus-range = <0x0 0xff>;
diff --git a/arch/arm64/boot/dts/freescale/fsl-ls1046a.dtsi b/arch/arm64/boot/dts/freescale/fsl-ls1046a.dtsi
index 457cefff7f73..251a7f0b367d 100644
--- a/arch/arm64/boot/dts/freescale/fsl-ls1046a.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-ls1046a.dtsi
@@ -731,6 +731,7 @@
 			#size-cells = <2>;
 			device_type = "pci";
 			dma-coherent;
+			iommu-map = <0 &smmu 0 1>;
 			num-lanes = <4>;
 			num-viewport = <8>;
 			num-ib-windows = <6>;
@@ -771,6 +772,7 @@
 			#size-cells = <2>;
 			device_type = "pci";
 			dma-coherent;
+			iommu-map = <0 &smmu 0 1>;
 			num-lanes = <2>;
 			num-viewport = <8>;
                         num-ib-windows = <6>;
@@ -811,6 +813,7 @@
 			#size-cells = <2>;
 			device_type = "pci";
 			dma-coherent;
+			iommu-map = <0 &smmu 0 1>;
 			num-lanes = <2>;
 			num-viewport = <8>;
                         num-ib-windows = <6>;
-- 
2.17.1

