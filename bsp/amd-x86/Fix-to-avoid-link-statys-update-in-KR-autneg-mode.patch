From 7ef62b7db5f64d398728a26b528111deeb7a60a7 Mon Sep 17 00:00:00 2001
From: Sudheesh Mavila <sudheesh.mavila@amd.com>
Date: Mon, 9 Dec 2019 22:37:41 +0530
Subject: [PATCH 3/4] Fix to avoid link statys update in KR autneg mode

Signed-off-by: Sudheesh Mavila <sudheesh.mavila@amd.com>
Signed-off-by: Zhang Xiao <xiao.zhang@windriver.com>
Signed-off-by: Liwei Song <liwei.song@windriver.com>
---
 drivers/net/ethernet/amd/xgbe/xgbe-mdio.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)
 mode change 100644 => 100755 drivers/net/ethernet/amd/xgbe/xgbe-mdio.c

diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-mdio.c b/drivers/net/ethernet/amd/xgbe/xgbe-mdio.c
old mode 100644
new mode 100755
index 8a3a60bb2688..7f3d256f629d
--- a/drivers/net/ethernet/amd/xgbe/xgbe-mdio.c
+++ b/drivers/net/ethernet/amd/xgbe/xgbe-mdio.c
@@ -1343,9 +1343,11 @@ static void xgbe_phy_status(struct xgbe_prv_data *pdata)
 
 	pdata->phy.link = pdata->phy_if.phy_impl.link_status(pdata,
 							     &an_restart);
+
 	if (an_restart) {
 		xgbe_phy_config_aneg(pdata);
-		return;
+		if(XGBE_MODE_KR != pdata->phy_if.phy_impl.cur_mode(pdata))
+			return;
 	}
 
 	if (pdata->phy.link) {
@@ -1364,7 +1366,7 @@ static void xgbe_phy_status(struct xgbe_prv_data *pdata)
 		if (test_bit(XGBE_LINK_INIT, &pdata->dev_state)) {
 			xgbe_check_link_timeout(pdata);
 
-			if (link_aneg)
+			if ((link_aneg) && (XGBE_MODE_KR != pdata->phy_if.phy_impl.cur_mode(pdata)))
 				return;
 		}
 
-- 
2.17.1

