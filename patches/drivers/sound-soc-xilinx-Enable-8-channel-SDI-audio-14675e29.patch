From 10bad0bf5e9ec9e374099ea8e6e0c9cbda79a92a Mon Sep 17 00:00:00 2001
From: Venkateshwar Rao Gannavarapu <venkateshwar.rao.gannavarapu@xilinx.com>
Date: Fri, 24 Jul 2020 11:17:54 -0700
Subject: [PATCH 1464/1851] sound: soc: xilinx: Enable 8-channel SDI audio

commit ada02e460b13662519ccc9e41b4322934b541168 from
https://github.com/Xilinx/linux-xlnx.git

Add 8-channel audio support to SDI.

Signed-off-by: Venkateshwar Rao Gannavarapu <venkateshwar.rao.gannavarapu@xilinx.com>
Reviewed-by: Hyun Kwon <hyun.kwon@xilinx.com>
State: pending
Signed-off-by: Yaliang Wang <Yaliang.Wang@windriver.com>
---
 sound/soc/xilinx/xlnx_sdi_audio.c | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/sound/soc/xilinx/xlnx_sdi_audio.c b/sound/soc/xilinx/xlnx_sdi_audio.c
index 75b0b3150b6f..304ca5aa1a83 100644
--- a/sound/soc/xilinx/xlnx_sdi_audio.c
+++ b/sound/soc/xilinx/xlnx_sdi_audio.c
@@ -339,8 +339,7 @@ static int xlnx_sdi_tx_hw_params(struct snd_pcm_substream *substream,
 
 	writel(val, base + XSDIAUD_AUD_CNTRL_REG_OFFSET);
 
-	/* TODO: support more channels, currently only 2. */
-	writel(CHAN_ID_1 | CHAN_ID_0, base + XSDIAUD_CH_VALID_REG_OFFSET);
+	writel(BIT(num_channels) - 1, base + XSDIAUD_CH_VALID_REG_OFFSET);
 
 	return 0;
 }
@@ -371,7 +370,7 @@ static struct snd_soc_dai_driver xlnx_sdi_rx_dai = {
 	.capture = {
 		.stream_name = "Capture",
 		.channels_min = 2,
-		.channels_max = 2,
+		.channels_max = 8,
 		.rates = SNDRV_PCM_RATE_32000 | SNDRV_PCM_RATE_44100 |
 			SNDRV_PCM_RATE_48000,
 		.formats = SNDRV_PCM_FMTBIT_S24_LE,
@@ -390,7 +389,7 @@ static struct snd_soc_dai_driver xlnx_sdi_tx_dai = {
 	.playback = {
 		.stream_name = "Playback",
 		.channels_min = 2,
-		.channels_max = 2,
+		.channels_max = 8,
 		.rates = SNDRV_PCM_RATE_32000 | SNDRV_PCM_RATE_44100 |
 			SNDRV_PCM_RATE_48000,
 		.formats = SNDRV_PCM_FMTBIT_S24_LE,
-- 
2.31.1

