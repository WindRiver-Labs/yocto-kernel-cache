From 4a892a9b250d633316ec57455100f05dbf98673a Mon Sep 17 00:00:00 2001
From: Julia Lawall <julia.lawall@inria.fr>
Date: Fri, 24 Jul 2020 12:05:31 +0200
Subject: [PATCH 23/28] printk: fix ifnullfree.cocci warnings

commit 463c6fa3f237bc254238b9f16d1906fda92caabb from linux-rt-devel

Make the code a little simpler by dropping
some unneeded tests.

Generated by: scripts/coccinelle/free/ifnullfree.cocci

Fixes: c406fbce2054 ("printk: implement syslog")
CC: John Ogness <john.ogness@linutronix.de>
Signed-off-by: kernel test robot <lkp@intel.com>
Signed-off-by: Sebastian Andrzej Siewior <bigeasy@linutronix.de>
Acked-by: John Ogness <john.ogness@linutronix.de>
Signed-off-by: Ovidiu Panait <ovidiu.panait@windriver.com>
---
 kernel/printk/printk.c | 12 ++++--------
 1 file changed, 4 insertions(+), 8 deletions(-)

diff --git a/kernel/printk/printk.c b/kernel/printk/printk.c
index a9b3d50febf2..f6cb243193b7 100644
--- a/kernel/printk/printk.c
+++ b/kernel/printk/printk.c
@@ -1466,10 +1466,8 @@ static int syslog_print_all(char __user *buf, int size, bool clear)
 	if (clear && !seq)
 		syslog_clear();
 
-	if (text)
-		kfree(text);
-	if (msgbuf)
-		kfree(msgbuf);
+	kfree(text);
+	kfree(msgbuf);
 	return len;
 }
 
@@ -1622,10 +1620,8 @@ int do_syslog(int type, char __user *buf, int len, int source)
 		break;
 	}
 out:
-	if (msgbuf)
-		kfree(msgbuf);
-	if (text)
-		kfree(text);
+	kfree(msgbuf);
+	kfree(text);
 	return error;
 }
 
-- 
2.31.1

